name: ${PROJECT_NAME:-nacos-cluster}
version: "3.8"
services:
  nacos1:
    hostname: nacos1
    container_name: nacos1
    image: nacos/nacos-server:${NACOS_VERSION}
    volumes:
      - ./cluster-logs/nacos1:/home/nacos/logs
    ports:
      - "7858:7858"
      - "8858:8858"
      - "9858:9858"
      - "9860:9859"
    environment:
      - NACOS_APPLICATION_PORT=8858
    env_file:
      - ./env/nacos-cluster.env
    restart: always

  nacos2:
    hostname: nacos2
    image: nacos/nacos-server:${NACOS_VERSION}
    container_name: nacos2
    volumes:
      - ./cluster-logs/nacos2:/home/nacos/logs
    ports:
      - "7868:7868"
      - "8868:8868"
      - "9868:9868"
      - "9870:9869"
    environment:
      - NACOS_APPLICATION_PORT=8868
    env_file:
      - ./env/nacos-cluster.env
    restart: always
  nacos3:
    hostname: nacos3
    image: nacos/nacos-server:${NACOS_VERSION}
    container_name: nacos3
    volumes:
      - ./cluster-logs/nacos3:/home/nacos/logs
    ports:
      - "7878:7878"
      - "8878:8878"
      - "9878:9878"
      - "9880:9879"
    environment:
      - NACOS_APPLICATION_PORT=8878
    env_file:
      - ./env/nacos-cluster.env
    restart: always
  nginx:
    image: nginx
    container_name: nginx
    volumes:
      - ./conf/nginx.conf:/etc/nginx/nginx.conf
    ports:
      - "8848:8848"
      - "9848:9848"
    restart: always
    depends_on:
      nacos1:
        condition: service_started
      nacos2:
        condition: service_started
      nacos3:
        condition: service_started
